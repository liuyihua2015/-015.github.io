<!DOCTYPE html>
<html lang="z">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>利用runtime,简单实现导航栏push页面的全屏返回 | liuyihua的多维空间</title>
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="The simpler  The happier">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="利用runtime,简单实现导航栏push页面的全屏返回 | liuyihua的多维空间">
    <meta name="twitter:description" content="The simpler  The happier">

    <meta property="og:type" content="article">
    <meta property="og:title" content="利用runtime,简单实现导航栏push页面的全屏返回 | liuyihua的多维空间">
    <meta property="og:description" content="The simpler  The happier">

    
    <meta name="author" content="liuyihua">
    
    <link rel="stylesheet" href="/css/vno.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

    
    <link rel="icon" href="/images/avatar-small.png">
    

    <meta name="generator" content="hexo"/>
    
    <link rel="alternate" type="application/rss+xml" title="liuyihua的多维空间" href="/atom.xml">
    

    <link rel="canonical" href="http://yoursite.com/2017/10/19/利用runtime,简单实现导航栏push页面的全屏返回/"/>

                 
</head>

<body class="home-template no-js">
    <script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>

    
<header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background-cover.jpg)">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/" title="前往 liuyihua的多维空间 的主页"><img src="/images/avatar.jpg" width="80" alt="liuyihua的多维空间 logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage for liuyihua的多维空间">liuyihua的多维空间</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">iOS swfit javaScript</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">The simpler  The happier</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        <div class="navigation-wrapper">
          <div>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="Visit the blog" class="blog-button">Blog</a></li>
            
              <li class="navigation__item"><a href="/favourite">黄金屋</a></li>
            
              <li class="navigation__item"><a href="/favourite/time.html">时光机</a></li>
            
              <li class="navigation__item"><a href="/favourite/image.html">幻想间</a></li>
            
              <li class="navigation__item"><a href="/aboutme">关于我</a></li>
            
            </ul>
          </nav>
          </div>
          <div>
          <nav class="cover-navigation navigation--social">
  <ul class="navigation">

  <!-- Weibo-->
  

  <!-- Github -->
  
  <li class="navigation__item">
    <a href="https://github.com/liuyihua2015" title="GitHub" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>


<!-- Stack Overflow -->
        

  <!-- Google Plus -->
  

<!-- Facebook -->

  
<!-- Twitter -->

  

  <li class="navigation__item">
    <a href="/atom.xml" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>



  </ul>
</nav>

          </div>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-purple"></div>
  </div> 
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single">

  <header class="post-header">
    <div class="post-meta">
      <time datetime="2017-10-19T09:21:58.454Z" class="post-list__meta--date date">2017-10-19</time> &#8226; <span class="post-meta__tags tags">于  </span>
      <span class="page-pv">
       Read <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>
      </span> 
   
    </div>
    <h1 class="post-title">利用runtime,简单实现导航栏push页面的全屏返回</h1>
  </header>

  <section class="post">
    <blockquote>
<p>主要的实现思路就是：自定义导航栏，利用runtime运行时机制，获取系统的手势target 和action，然后将系统的手势加到导航控制器的视图，实现全屏返回；</p>
</blockquote>
<p>####OC操作如下：</p>
<p>1.自定义导航栏，导入运行时框架，遵守代理协议：UIGestureRecognizerDelegate</p>
<pre><code>#import &lt;objc/runtime.h&gt;
@interface MainNavVC :   UINavigationController&lt;UIGestureRecognizerDelegate&gt;
</code></pre><p>2.在 viewDidLoad 中实现如下代码：</p>
<pre><code> //    1.使用运行时，打印手势中的所有属性
//    unsigned int count = 0;
//    Ivar  * ivars  =  class_copyIvarList([UIGestureRecognizer class], &amp;count);
//    for (int i = 0; i &lt; count; i++) {
//        const char * name =  ivar_getName(ivars[i]);
//        NSLog(@&quot;%s&quot;,name);
//    }

//    2.获取当前interactivePopGestureRecognizer 中的“ _targets” 数据，取第一个；
id targets =  [self.interactivePopGestureRecognizer valueForKey:@&quot;_targets&quot;];
id targetObjc = targets[0];
id target = [targetObjc valueForKey:@&quot;target&quot;];
SEL action = NSSelectorFromString(@&quot;handleNavigationTransition:&quot;);
UIGestureRecognizer * panGes = [[UIPanGestureRecognizer alloc]initWithTarget:target action:action];
[self.view addGestureRecognizer:panGes];
</code></pre><p>另一种写法:思想还是上面的思想</p>
<p> （1）获取系统自带滑动手势的target对象</p>
<pre><code>id target = self.interactivePopGestureRecognizer.delegate;
// 创建全屏滑动手势，调用系统自带滑动手势的target的action方法
UIGestureRecognizer * apopRecognizer = [[UIPanGestureRecognizer alloc] initWithTarget:target action:@selector(handleNavigationTransition:)];
// 设置手势代理，拦截手势触发
apopRecognizer.delegate = self;
// 给导航控制器的view添加全屏滑动手势
[self.view addGestureRecognizer:apopRecognizer];
// 禁止使用系统自带的滑动手势
self.interactivePopGestureRecognizer.enabled = NO;
</code></pre><p>（2）本地实现 handleNavigationTransition 方法：</p>
<pre><code>- (void)handleNavigationTransition:(UIPanGestureRecognizer *)recognizer {
//    [[self class] cancelPreviousPerformRequestsWithTarget:self selector:@selector(todoSomething:) object:recognizer];
//    [self performSelector:@selector(todoSomething:) withObject:recognizer afterDelay:0.2f];
//
/**
 * 稳定进度区间，让它在0.0（未完成）～1.0（已完成）之间
 */
    CGFloat progress = [recognizer translationInView:recognizer.view].x / recognizer.view.bounds.size.width;
    progress = MIN(1.0, MAX(0.0, progress));
    NSLog(@&quot;progress ==  %f&quot;,progress);
    if (recognizer.state == UIGestureRecognizerStateBegan) {
        NSLog(@&quot;UIGestureRecognizerStateBegan&quot;);
    }
    else if (recognizer.state == UIGestureRecognizerStatePossible) {
        NSLog(@&quot;UIGestureRecognizerStatePossible&quot;);
    }
    else if (recognizer.state == UIGestureRecognizerStateFailed) {
        NSLog(@&quot;UIGestureRecognizerStateFailed == &quot; );
    }
    else if (recognizer.state == UIGestureRecognizerStateEnded || recognizer.state ==     UIGestureRecognizerStateCancelled) {
        NSLog(@&quot;UIGestureRecognizerStateEnded&quot;);
        if (progress &gt; 0.5) {
        } else {
        }
    }
}
</code></pre><p>####swift操作如下：<br>override func viewDidLoad() {<br>        super.viewDidLoad()</p>
<pre><code>    //1.使用运行时，打印手势中所有的属性
    //        var count :UInt32 = 0
    //        let ivars =  class_copyIvarList(UIGestureRecognizer.self, &amp;count)!
    //        for i in 0 ..&lt; count {
    //            let namep = ivar_getName(ivars[Int(i)])!
    //            let name = String(cString:namep)
    //            print(name)
    //        }

    guard let targets = interactivePopGestureRecognizer!.value(forKey: &quot;_targets&quot;) as? [NSObject] else {
        return
    }
    let targetObjc = targets[0]
    let target = targetObjc.value(forKey: &quot;target&quot;)
    let action = Selector((&quot;handleNavigationTransition:&quot;))
    let panGes = UIPanGestureRecognizer(target: target, action: action)
    panGes.delegate = self
    view.addGestureRecognizer(panGes)

}
</code></pre><p>遵守代理协议，根控制器取消手势事件</p>
<pre><code>extension HZNavigationController:UIGestureRecognizerDelegate{
      func gestureRecognizerShouldBegin(_ gestureRecognizer: UIGestureRecognizer) -&gt; Bool {
            // 注意：只有非根控制器才有滑动返回功能，根控制器没有。
           // 判断导航控制器是否只有一个子控制器，如果只有一个子控制器，肯定是根控制器
          if (self.childViewControllers.count == 1) {
              // 表示用户在根控制器界面，就不需要触发滑动手势，
              return false;
          }
          // 当前页面是显示结果页，不响应滑动手势
          let vc = self.childViewControllers.last!
          if vc.isKind(of: UIInputViewController.self){
              return false;
          }
          return true

      }

}
</code></pre>
  </section>

</article>

<section class="read-more">
           
    
        
        
               
            <div class="read-more-item">
                <span class="read-more-item-dim">Older Post</span>
                <h2 class="post-list__post-title post-title"><a href="/2017/10/19/hello-world/" title="Hello World">Hello World</a></h2>
                <p class="excerpt">
                
                Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in 
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2017-10-19T05:46:58.239Z" class="post-list__meta--date date">2017-10-19</time> &#8226; <span class="post-list__meta--tags tags">于 </span><a class="btn-border-small" href="/2017/10/19/hello-world/">继续阅读</a></div>
                       
            </div>
        
     
   
   
  
</section>

  

            <footer class="footer">
    <span class="footer__copyright">
        &copy; 2017 liuyihua - 本站点采用 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>
       
    </span>
    <span class="footer__copyright">
             - 基于 <a href="http://hexo.io">Hexo</a> 搭建，使用 <a href="https://github.com/monniya/hexo-theme-new-vno ">new-vno</a> 主题，由<a href="https://monniya.com ">@Monniya</a> 修改自 <a href="https://github.com/lenbo-ma/hexo-theme-vno" target="_blank">Vno</a>, 原创出自<a href="http://github.com/onevcat/vno" target="_blank">onevcat</a>
         </span>
       
    
    
</footer>


        </div>
    </div>

     
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-78918255-1', 'auto');
	ga('send', 'pageview');
</script>

    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?9cdad07c755fa23f6aced510c6760e87";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>



    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    
</body>
</html>
